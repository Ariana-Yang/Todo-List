<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- 设置文档字符集和视口，确保在移动设备上正确显示 -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 页面标题，显示在浏览器标签上 -->
    <title>我的待办清单</title>
    <title>Test</title>
    <style>
        /* 重置浏览器默认样式，确保跨浏览器一致性 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* 页面整体样式 */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8fafc;
            color: #333;
            line-height: 1.6;
        }

        /* 主容器，限制最大宽度并居中显示 */
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }

        /* 页面标题样式 */
        h1 {
            text-align: center;
            color: #3b82f6; /* 主色调：明亮蓝色 */
            font-size: 28px;
            margin-bottom: 30px;
            font-weight: 600;
        }

        /* 输入区域样式，使用flex布局使输入框和按钮水平排列 */
        .input-area {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 25px;
        }
        
        /* 输入框和字符计数容器 */
        .input-container {
            display: flex;
            gap: 10px;
            align-items: stretch;
        }
        
        /* 字符计数样式 */
        .char-count {
            font-size: 14px;
            color: #6b7280;
            text-align: right;
            margin-top: -4px;
            transition: color 0.2s ease;
        }
        
        /* 字符计数超过限制时的样式 */
        .char-count.limit-reached {
            color: #ef4444;
            font-weight: 500;
        }

        /* 输入框样式 */
        .task-input {
            flex: 1; /* 输入框占据剩余空间 */
            padding: 12px 16px;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s ease;
        }

        /* 输入框聚焦时的样式变化 */
        .task-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* 添加按钮样式 */
        .add-btn {
            padding: 12px 24px;
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
            white-space: nowrap;
        }

        /* 添加按钮悬停效果 */
        .add-btn:hover {
            background-color: #2563eb;
        }

        /* 任务列表容器 */
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* 单个任务项样式 */
        .task-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: transform 0.1s ease, box-shadow 0.2s ease;
            border-bottom: 1px solid #e5e7eb;
        }

        /* 任务项悬停效果 */
        .task-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        /* 任务内容样式 */
        .task-content {
            flex: 1;
            font-size: 16px;
            color: #333;
            margin-right: 16px;
            word-wrap: break-word;
            word-break: break-word;
        }

        /* 任务按钮容器 */
        .task-buttons {
            display: flex;
            gap: 8px;
        }

        /* 完成按钮样式 */
        .complete-btn {
            padding: 8px 16px;
            background-color: #10b981;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        /* 完成按钮悬停效果 */
        .complete-btn:hover {
            background-color: #059669;
        }

        /* 删除按钮样式 */
        .delete-btn {
            padding: 8px 16px;
            background-color: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        /* 删除按钮悬停效果 */
        .delete-btn:hover {
            background-color: #dc2626;
        }
        
        /* 编辑按钮样式 */
        .edit-btn {
            padding: 8px 16px;
            background-color: #6b7280;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        /* 编辑按钮悬停效果 */
        .edit-btn:hover {
            background-color: #4b5563;
        }
        
        /* 编辑模式容器样式 */
        .task-edit-mode {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        /* 编辑模式输入框样式 */
        .edit-input {
            padding: 12px 16px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            font-size: 16px;
            outline: none;
        }
        
        /* 编辑模式选择器样式 */
        .edit-select {
            padding: 8px 12px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            font-size: 14px;
            background-color: white;
            cursor: pointer;
            outline: none;
        }
        
        /* 编辑模式选项组样式 */
        .edit-options {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        /* 编辑模式按钮组样式 */
        .edit-buttons {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }
        
        /* 保存按钮样式 */
        .save-btn {
            padding: 8px 16px;
            background-color: #10b981;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        /* 保存按钮悬停效果 */
        .save-btn:hover {
            background-color: #059669;
        }
        
        /* 取消编辑按钮样式 */
        .cancel-edit-btn {
            padding: 8px 16px;
            background-color: #6b7280;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        /* 取消编辑按钮悬停效果 */
        .cancel-edit-btn:hover {
            background-color: #4b5563;
        }

        /* 清空已完成任务按钮容器 */
        .clear-completed {
            margin-top: 20px;
            display: flex;
            justify-content: center;
        }

        /* 清空已完成按钮样式 */
        .clear-btn {
            padding: 10px 20px;
            background-color: #f3f4f6;
            color: #6b7280;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 1;
            visibility: visible;
        }

        /* 清空已完成按钮悬停效果 */
        .clear-btn:hover {
            background-color: #e5e7eb;
            color: #374151;
        }

        /* 隐藏清空已完成按钮的样式 */
        .clear-btn.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        /* 搜索区域样式 */
        .search-area {
            margin-bottom: 15px;
        }

        /* 搜索输入框样式 */
        .search-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s ease;
        }

        /* 搜索输入框聚焦效果 */
        .search-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* 分类筛选区域样式 */
        .filter-area {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        /* 筛选标签样式 */
        .filter-label {
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
            white-space: nowrap;
        }

        /* 筛选选项容器样式 */
        .filter-options {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* 筛选按钮样式 */
        .filter-btn {
            padding: 8px 16px;
            background-color: #f3f4f6;
            color: #6b7280;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        /* 筛选按钮悬停效果 */
        .filter-btn:hover {
            background-color: #e5e7eb;
            color: #374151;
        }

        /* 筛选按钮激活状态 */
        .filter-btn.active {
            background-color: var(--category-color, #3b82f6);
            color: white;
            border-color: var(--category-color, #3b82f6);
        }

        /* 任务选项容器样式 */
        .task-options {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* 选项组样式 */
        .option-group {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* 选项标签样式 */
        .option-group label {
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
        }

        /* 分类选择样式 */
        .category-select,
        .priority-select {
            padding: 8px 12px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            font-size: 14px;
            background-color: white;
            cursor: pointer;
            outline: none;
            transition: border-color 0.2s ease;
        }

        /* 选择控件聚焦效果 */
        .category-select:focus,
        .priority-select:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* 任务项内的分类标签样式 */
        .category-tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            color: white;
            margin-right: 8px;
            background-color: var(--category-color);
        }

        /* 任务项内的优先级标识样式 */
        .priority-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        /* 高优先级样式 */
        .priority-high {
            background-color: #FF4D4F;
        }

        /* 中优先级样式 */
        .priority-medium {
            background-color: #FAAD14;
        }

        /* 低优先级样式 */
        .priority-low {
            background-color: #8C8C8C;
        }

        /* 任务内容和标识容器 */
        .task-main {
            display: flex;
            align-items: center;
            flex: 1;
            margin-right: 16px;
        }

        /* 响应式设计：适配手机屏幕（宽度375px） */
        @media (max-width: 375px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 24px;
                margin-bottom: 20px;
            }

            .input-area {
                flex-direction: column;
            }

            .task-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .task-content {
                margin-right: 0;
            }

            .task-buttons {
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <!-- 主容器，所有内容居中显示 -->
    <div class="container">
        <!-- 页面标题 -->
        <h1>我的待办清单</h1>

        <!-- 搜索区域 -->
        <div class="search-area">
            <input 
                type="text" 
                class="search-input" 
                placeholder="搜索任务..."
                id="searchInput"
            >
        </div>

        <!-- 分类筛选区域 -->
        <div class="filter-area">
            <div class="filter-label">分类筛选：</div>
            <div class="filter-options">
                <button type="button" class="filter-btn active" data-category="all">全部</button>
                <button type="button" class="filter-btn" data-category="工作" style="--category-color: #3b82f6;">工作</button>
                <button type="button" class="filter-btn" data-category="生活" style="--category-color: #10b981;">生活</button>
                <button type="button" class="filter-btn" data-category="学习" style="--category-color: #f97316;">学习</button>
            </div>
        </div>

        <!-- 输入区域：用于添加新任务 -->
        <div class="input-area">
            <div class="input-container">
                <input 
                    type="text" 
                    class="task-input" 
                    placeholder="输入新任务..."
                >
            </div>
            
            <!-- 分类和优先级选择 -->
            <div class="task-options">
                <div class="option-group">
                    <label for="categorySelect">分类：</label>
                    <select id="categorySelect" class="category-select">
                        <option value="工作">工作</option>
                        <option value="生活">生活</option>
                        <option value="学习">学习</option>
                    </select>
                </div>
                
                <div class="option-group">
                    <label for="prioritySelect">优先级：</label>
                    <select id="prioritySelect" class="priority-select">
                        <option value="低">低</option>
                        <option value="中" selected>中</option>
                        <option value="高">高</option>
                    </select>
                </div>
                
                <button type="button" class="add-btn">添加</button>
            </div>
            
            <div class="char-count" id="charCount">0/100</div>
        </div>

        <!-- 任务列表区域 -->
        <div class="task-list"></div>
        
        <!-- 清空已完成任务按钮 -->
        <div class="clear-completed">
            <button type="button" class="clear-btn">清空已完成</button>
        </div>
    </div>

    <script>
        // 等待页面完全加载后执行代码
        document.addEventListener('DOMContentLoaded', function() {
            // 获取DOM元素
            const taskInput = document.querySelector('.task-input'); // 任务输入框
            const addBtn = document.querySelector('.add-btn'); // 添加按钮
            const taskList = document.querySelector('.task-list'); // 任务列表
            const clearBtn = document.querySelector('.clear-btn'); // 清空已完成按钮
            const charCount = document.getElementById('charCount'); // 字符计数显示
            const maxLength = 100; // 最大字符限制
            const searchInput = document.getElementById('searchInput'); // 搜索输入框
            const filterBtns = document.querySelectorAll('.filter-btn'); // 分类筛选按钮
            const categorySelect = document.getElementById('categorySelect'); // 分类选择器
            const prioritySelect = document.getElementById('prioritySelect'); // 优先级选择器
            
            // 全局变量
            let currentFilter = 'all'; // 当前筛选分类
            let currentSearch = ''; // 当前搜索关键词

            // 切换到编辑模式
            function switchToEditMode(taskItem) {
                // 获取任务的当前数据
                const taskContent = taskItem.querySelector('.task-content').textContent;
                const category = taskItem.dataset.category;
                const priority = taskItem.dataset.priority;
                
                // 创建编辑模式的HTML结构
                const editHTML = `
                    <div class="task-edit-mode">
                        <input 
                            type="text" 
                            class="edit-input" 
                            value="${taskContent}" 
                            placeholder="输入任务内容..."
                            maxlength="100"
                            id="editContent"
                        >
                        <div class="edit-options">
                            <div class="option-group">
                                <label for="editCategory">分类：</label>
                                <select id="editCategory" class="edit-select">
                                    <option value="工作" ${category === '工作' ? 'selected' : ''}>工作</option>
                                    <option value="生活" ${category === '生活' ? 'selected' : ''}>生活</option>
                                    <option value="学习" ${category === '学习' ? 'selected' : ''}>学习</option>
                                </select>
                            </div>
                            <div class="option-group">
                                <label for="editPriority">优先级：</label>
                                <select id="editPriority" class="edit-select">
                                    <option value="低" ${priority === '低' ? 'selected' : ''}>低</option>
                                    <option value="中" ${priority === '中' ? 'selected' : ''}>中</option>
                                    <option value="高" ${priority === '高' ? 'selected' : ''}>高</option>
                                </select>
                            </div>
                        </div>
                        <div class="edit-buttons">
                            <button type="button" class="save-btn">保存</button>
                            <button type="button" class="cancel-edit-btn">取消</button>
                        </div>
                    </div>
                `;
                
                // 保存原有的HTML结构，用于取消编辑时恢复
                taskItem.dataset.originalHtml = taskItem.innerHTML;
                
                // 切换到编辑模式
                taskItem.innerHTML = editHTML;
                
                // 为保存和取消按钮添加事件监听器
                const saveBtn = taskItem.querySelector('.save-btn');
                const cancelBtn = taskItem.querySelector('.cancel-edit-btn');
                
                // 保存按钮点击事件
                saveBtn.addEventListener('click', function() {
                    saveEdit(taskItem);
                });
                
                // 取消按钮点击事件
                cancelBtn.addEventListener('click', function() {
                    cancelEdit(taskItem);
                });
            }
            
            // 保存编辑
            function saveEdit(taskItem) {
                // 获取编辑后的数据
                const editInput = taskItem.querySelector('.edit-input');
                const newContent = editInput.value.trim();
                const newCategory = taskItem.querySelector('#editCategory').value;
                const newPriority = taskItem.querySelector('#editPriority').value;
                
                // 检查输入是否为空
                if (newContent !== '') {
                    // 获取分类颜色
                    const categoryColor = getCategoryColor(newCategory);
                    // 获取优先级样式类名
                    const priorityClass = getPriorityClass(newPriority);
                    // 检查任务是否已完成
                    const completed = taskItem.classList.contains('completed');
                    
                    // 创建更新后的任务HTML
                    let taskHTML;
                    if (completed) {
                        taskHTML = `
                            <div class="task-main">
                                <div class="priority-indicator ${priorityClass}"></div>
                                <div class="category-tag clickable" style="background-color: ${categoryColor}; cursor: pointer;" data-category="${newCategory}">${newCategory}</div>
                                <div class="task-content" style="text-decoration: line-through; color: #9ca3af;">${newContent}</div>
                            </div>
                            <div class="task-buttons">
                                <button type="button" class="edit-btn">编辑</button>
                                <button type="button" class="complete-btn">取消</button>
                                <button type="button" class="delete-btn">删除</button>
                            </div>
                        `;
                    } else {
                        taskHTML = `
                            <div class="task-main">
                                <div class="priority-indicator ${priorityClass}"></div>
                                <div class="category-tag clickable" style="background-color: ${categoryColor}; cursor: pointer;" data-category="${newCategory}">${newCategory}</div>
                                <div class="task-content">${newContent}</div>
                            </div>
                            <div class="task-buttons">
                                <button type="button" class="edit-btn">编辑</button>
                                <button type="button" class="complete-btn">完成</button>
                                <button type="button" class="delete-btn">删除</button>
                            </div>
                        `;
                    }
                    
                    // 更新任务HTML
                    taskItem.innerHTML = taskHTML;
                    
                    // 更新任务数据属性
                    taskItem.dataset.category = newCategory;
                    taskItem.dataset.priority = newPriority;
                    
                    // 重新添加事件监听器
                    addButtonListeners();
                    
                    // 排序任务
                    sortTasks();
                    
                    // 应用筛选
                    applyFilters();
                    
                    // 保存到localStorage
                    saveTodoList();
                }
            }
            
            // 取消编辑
            function cancelEdit(taskItem) {
                // 恢复原有的HTML结构
                taskItem.innerHTML = taskItem.dataset.originalHtml;
                
                // 重新添加事件监听器
                addButtonListeners();
            }
            
            // 为分类标签添加点击事件监听器的函数
            function addCategoryTagListeners() {
                // 获取所有可点击的分类标签
                const categoryTags = document.querySelectorAll('.category-tag.clickable');
                
                // 遍历所有分类标签，添加点击事件监听器
                categoryTags.forEach(function(tag) {
                    tag.addEventListener('click', function() {
                        // 获取标签对应的分类
                        const category = this.dataset.category;
                        // 找到对应的筛选按钮
                        const correspondingBtn = document.querySelector(`.filter-btn[data-category="${category}"]`);
                        // 如果找到对应的按钮，模拟点击
                        if (correspondingBtn) {
                            correspondingBtn.click();
                        }
                    });
                });
            }
            
            // 为所有按钮添加点击事件监听器的函数
            function addButtonListeners() {
                // 获取所有删除按钮
                const deleteBtns = document.querySelectorAll('.delete-btn');
                
                // 遍历所有删除按钮，添加点击事件监听器
                deleteBtns.forEach(function(deleteBtn) {
                    // 移除可能存在的旧事件监听器，避免重复添加
                    deleteBtn.removeEventListener('click', handleDelete);
                    // 添加新的点击事件监听器
                    deleteBtn.addEventListener('click', handleDelete);
                });
                
                // 获取所有完成按钮
                const completeBtns = document.querySelectorAll('.complete-btn');
                
                // 遍历所有完成按钮，添加点击事件监听器
                completeBtns.forEach(function(completeBtn) {
                    // 移除可能存在的旧事件监听器，避免重复添加
                    completeBtn.removeEventListener('click', handleComplete);
                    // 添加新的点击事件监听器
                    completeBtn.addEventListener('click', handleComplete);
                });
                
                // 获取所有编辑按钮
                const editBtns = document.querySelectorAll('.edit-btn');
                
                // 遍历所有编辑按钮，添加点击事件监听器
                editBtns.forEach(function(editBtn) {
                    editBtn.addEventListener('click', function() {
                        // 获取当前编辑按钮所在的任务项
                        const taskItem = this.closest('.task-item');
                        // 切换到编辑模式
                        switchToEditMode(taskItem);
                    });
                });
                
                // 为分类标签添加点击事件监听器
                addCategoryTagListeners();
            }
            
            // 删除任务的处理函数
            function handleDelete() {
                // 获取当前删除按钮所在的任务项
                const taskItem = this.closest('.task-item');
                // 删除该任务项
                taskItem.remove();
                
                // 保存任务列表到localStorage
                saveTodoList();
            }
            
            // 更新清空已完成按钮的显示状态
            function updateClearButtonVisibility() {
                // 获取所有已完成的任务项
                const completedTasks = document.querySelectorAll('.task-item.completed');
                
                // 如果有已完成任务，显示清空按钮；否则隐藏
                if (completedTasks.length > 0) {
                    clearBtn.classList.remove('hidden');
                } else {
                    clearBtn.classList.add('hidden');
                }
            }
            
            // 清空已完成任务的处理函数
            function handleClearCompleted() {
                // 获取所有已完成的任务项
                const completedTasks = document.querySelectorAll('.task-item.completed');
                
                // 遍历所有已完成任务项并删除
                completedTasks.forEach(function(taskItem) {
                    taskItem.remove();
                });
                
                // 更新清空已完成按钮的显示状态
                updateClearButtonVisibility();
                
                // 保存任务列表到localStorage
                saveTodoList();
            }
            
            // 标记/取消完成任务的处理函数
            function handleComplete() {
                // 获取当前完成按钮所在的任务项
                const taskItem = this.closest('.task-item');
                // 获取任务内容元素
                const taskContent = taskItem.querySelector('.task-content');
                
                // 检查任务是否已完成
                const isCompleted = taskItem.classList.contains('completed');
                
                if (isCompleted) {
                    // 取消完成状态
                    taskItem.classList.remove('completed');
                    // 移除删除线和灰色文字样式
                    taskContent.style.textDecoration = 'none';
                    taskContent.style.color = '#333';
                    // 按钮文字变回"完成"
                    this.textContent = '完成';
                    // 将任务项移到列表顶部
                    taskList.insertBefore(taskItem, taskList.firstChild);
                } else {
                    // 标记为已完成
                    taskItem.classList.add('completed');
                    // 添加删除线和灰色文字样式
                    taskContent.style.textDecoration = 'line-through';
                    taskContent.style.color = '#9ca3af';
                    // 按钮文字变成"取消"
                    this.textContent = '取消';
                    // 将任务项移到列表底部
                    taskList.appendChild(taskItem);
                }
                
                // 更新清空已完成按钮的显示状态
                updateClearButtonVisibility();
                
                // 保存任务列表到localStorage
                saveTodoList();
            }
            
            // 为清空已完成按钮添加点击事件监听器
            clearBtn.addEventListener('click', handleClearCompleted);
            
            // 更新字符计数显示
            function updateCharCount() {
                const currentLength = taskInput.value.length;
                charCount.textContent = `${currentLength}/${maxLength}`;
                
                // 如果超过限制，添加限制样式
                if (currentLength >= maxLength) {
                    charCount.classList.add('limit-reached');
                } else {
                    charCount.classList.remove('limit-reached');
                }
            }
            
            // 输入事件处理函数
            function handleInput() {
                let currentLength = taskInput.value.length;
                
                // 如果已经超过最大长度，截断文本
                if (currentLength > maxLength) {
                    taskInput.value = taskInput.value.substring(0, maxLength);
                    currentLength = maxLength;
                }
                
                // 更新字符计数
                updateCharCount();
            }
            
            // 为输入框添加输入事件监听器
            taskInput.addEventListener('input', handleInput);
            
            // 从localStorage读取任务列表，初始化页面
            loadTodoList();
            
            // 获取分类颜色
            function getCategoryColor(category) {
                switch(category) {
                    case '工作':
                        return '#3b82f6';
                    case '生活':
                        return '#10b981';
                    case '学习':
                        return '#f97316';
                    default:
                        return '#3b82f6';
                }
            }
            
            // 获取优先级样式类名
            function getPriorityClass(priority) {
                switch(priority) {
                    case '高':
                        return 'priority-high';
                    case '中':
                        return 'priority-medium';
                    case '低':
                        return 'priority-low';
                    default:
                        return 'priority-medium';
                }
            }
            
            // 保存任务列表到localStorage
            function saveTodoList() {
                // 获取所有任务项
                const taskItems = document.querySelectorAll('.task-item');
                // 创建任务列表数组
                const todoList = [];
                
                // 遍历所有任务项，收集任务数据
                taskItems.forEach(function(item) {
                    // 获取任务内容
                    const content = item.querySelector('.task-content').textContent;
                    // 检查任务是否已完成
                    const completed = item.classList.contains('completed');
                    // 获取任务分类
                    const category = item.dataset.category;
                    // 获取任务优先级
                    const priority = item.dataset.priority;
                    // 获取任务创建时间
                    const createdAt = item.dataset.createdAt;
                    // 将任务数据添加到数组
                    todoList.push({
                        content: content,
                        completed: completed,
                        category: category,
                        priority: priority,
                        createdAt: createdAt
                    });
                });
                
                // 将任务列表转换为JSON字符串，保存到localStorage
                localStorage.setItem('todoList', JSON.stringify(todoList));
            }
            
            // 从localStorage读取任务列表
            function loadTodoList() {
                // 从localStorage获取保存的任务列表JSON字符串
                const savedList = localStorage.getItem('todoList');
                
                // 如果没有保存的数据，直接返回
                if (!savedList) {
                    return;
                }
                
                // 将JSON字符串解析为JavaScript数组
                let todoList = JSON.parse(savedList);
                
                // 任务排序：按优先级从高到低，相同优先级按创建时间从新到旧
                todoList.sort(function(a, b) {
                    // 优先级权重
                    const priorityWeight = {
                        '高': 3,
                        '中': 2,
                        '低': 1
                    };
                    
                    // 按优先级排序
                    const priorityDiff = priorityWeight[b.priority || '中'] - priorityWeight[a.priority || '中'];
                    if (priorityDiff !== 0) {
                        return priorityDiff;
                    }
                    
                    // 按创建时间从新到旧排序
                    return new Date(b.createdAt || 0) - new Date(a.createdAt || 0);
                });
                
                // 清空当前任务列表
                taskList.innerHTML = '';
                
                // 遍历任务列表，创建任务项
                todoList.forEach(function(task) {
                    // 创建新的任务项元素
                    const taskItem = document.createElement('div');
                    taskItem.className = 'task-item';
                    // 设置任务数据属性
                    taskItem.dataset.category = task.category || '工作';
                    taskItem.dataset.priority = task.priority || '中';
                    taskItem.dataset.createdAt = task.createdAt || Date.now();
                    
                    // 获取分类颜色和优先级样式
                    const categoryColor = getCategoryColor(task.category || '工作');
                    const priorityClass = getPriorityClass(task.priority || '中');
                    
                    // 根据任务是否已完成，设置不同的HTML内容
                    if (task.completed) {
                        taskItem.classList.add('completed');
                        taskItem.innerHTML = `
                            <div class="task-main">
                                <div class="priority-indicator ${priorityClass}"></div>
                                <div class="category-tag clickable" style="background-color: ${categoryColor}; cursor: pointer;" data-category="${task.category || '工作'}">${task.category || '工作'}</div>
                                <div class="task-content" style="text-decoration: line-through; color: #9ca3af;">${task.content}</div>
                            </div>
                            <div class="task-buttons">
                                <button type="button" class="edit-btn">编辑</button>
                                <button type="button" class="complete-btn">取消</button>
                                <button type="button" class="delete-btn">删除</button>
                            </div>
                        `;
                    } else {
                        taskItem.innerHTML = `
                            <div class="task-main">
                                <div class="priority-indicator ${priorityClass}"></div>
                                <div class="category-tag clickable" style="background-color: ${categoryColor}; cursor: pointer;" data-category="${task.category || '工作'}">${task.category || '工作'}</div>
                                <div class="task-content">${task.content}</div>
                            </div>
                            <div class="task-buttons">
                                <button type="button" class="edit-btn">编辑</button>
                                <button type="button" class="complete-btn">完成</button>
                                <button type="button" class="delete-btn">删除</button>
                            </div>
                        `;
                    }
                    
                    // 将任务项添加到任务列表
                    taskList.appendChild(taskItem);
                });
                
                // 应用当前筛选和搜索
                applyFilters();
                // 为所有按钮添加事件监听器
                addButtonListeners();
                // 更新清空已完成按钮的显示状态
                updateClearButtonVisibility();
            }
            
            // 应用筛选和搜索
            function applyFilters() {
                const taskItems = document.querySelectorAll('.task-item');
                
                taskItems.forEach(function(item) {
                    const category = item.dataset.category;
                    const content = item.querySelector('.task-content').textContent.toLowerCase();
                    const matchesFilter = currentFilter === 'all' || category === currentFilter;
                    const matchesSearch = currentSearch === '' || content.includes(currentSearch.toLowerCase());
                    
                    if (matchesFilter && matchesSearch) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            }
            
            // 任务排序函数
            function sortTasks() {
                // 获取所有任务项
                const taskItems = Array.from(document.querySelectorAll('.task-item'));
                
                // 排序：按优先级从高到低，相同优先级按创建时间从新到旧
                taskItems.sort(function(a, b) {
                    // 优先级权重
                    const priorityWeight = {
                        '高': 3,
                        '中': 2,
                        '低': 1
                    };
                    
                    // 按优先级排序
                    const priorityDiff = priorityWeight[b.dataset.priority] - priorityWeight[a.dataset.priority];
                    if (priorityDiff !== 0) {
                        return priorityDiff;
                    }
                    
                    // 按创建时间从新到旧排序
                    return new Date(b.dataset.createdAt) - new Date(a.dataset.createdAt);
                });
                
                // 清空任务列表
                taskList.innerHTML = '';
                
                // 将排序后的任务项添加回列表
                taskItems.forEach(function(item) {
                    taskList.appendChild(item);
                });
            }
            
            // 初始化字符计数
            updateCharCount();

            // 为搜索输入框添加输入事件监听器
            searchInput.addEventListener('input', function() {
                currentSearch = this.value;
                applyFilters();
            });
            
            // 为分类筛选按钮添加点击事件监听器
            filterBtns.forEach(function(btn) {
                btn.addEventListener('click', function() {
                    // 移除所有按钮的active类
                    filterBtns.forEach(function(b) {
                        b.classList.remove('active');
                    });
                    // 为当前按钮添加active类
                    this.classList.add('active');
                    // 更新当前筛选分类
                    currentFilter = this.dataset.category;
                    // 应用筛选
                    applyFilters();
                });
            });

            // 为添加按钮添加点击事件监听器
            addBtn.addEventListener('click', function() {
                // 获取输入框的值，并去除首尾空格
                const taskText = taskInput.value.trim();

                // 检查输入是否为空
                if (taskText !== '') {
                    // 获取选择的分类
                    const category = categorySelect.value;
                    // 获取选择的优先级
                    const priority = prioritySelect.value;
                    // 获取当前时间作为创建时间
                    const createdAt = Date.now().toString();
                    // 获取分类颜色
                    const categoryColor = getCategoryColor(category);
                    // 获取优先级样式类名
                    const priorityClass = getPriorityClass(priority);
                    
                    // 创建新的任务项元素
                    const taskItem = document.createElement('div');
                    taskItem.className = 'task-item';
                    // 设置任务数据属性
                    taskItem.dataset.category = category;
                    taskItem.dataset.priority = priority;
                    taskItem.dataset.createdAt = createdAt;

                    // 设置任务项的HTML内容
                    taskItem.innerHTML = `
                        <div class="task-main">
                            <div class="priority-indicator ${priorityClass}"></div>
                            <div class="category-tag clickable" style="background-color: ${categoryColor}; cursor: pointer;" data-category="${category}">${category}</div>
                            <div class="task-content">${taskText}</div>
                        </div>
                        <div class="task-buttons">
                            <button type="button" class="complete-btn">完成</button>
                            <button type="button" class="delete-btn">删除</button>
                        </div>
                    `;

                    // 将新任务项添加到任务列表
                    taskList.appendChild(taskItem);
                    
                    // 对任务进行排序
                    sortTasks();
                    
                    // 应用筛选和搜索
                    applyFilters();

                    // 为所有按钮重新添加事件监听器，包括新添加的任务项
                    addButtonListeners();

                    // 清空输入框
                    taskInput.value = '';
                    
                    // 重置分类和优先级选择
                    categorySelect.value = '工作';
                    prioritySelect.value = '中';
                    
                    // 更新字符计数
                    updateCharCount();
                    
                    // 保存任务列表到localStorage
                    saveTodoList();
                }
            });
        });
    </script>
</body>
</html>